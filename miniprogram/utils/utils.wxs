// 纯云开发环境，不使用外部服务器
// var BASE_URL = '';  // 已移除外部服务器依赖

function getFullImageUrl(img) {
  // 1. Handle empty or null values
  if (!img) {
    // console.log('WXS: Input image is empty'); // WXS doesn't support console.log
    return '';
  }

  // 2. Handle wxfile temporary paths
  // WXS doesn't have startsWith, use indexOf
  if (img.indexOf('wxfile://') === 0) {
    return img;
  }

  // 3. Handle already absolute URLs
  if (img.indexOf('https://') === 0 || img.indexOf('http://') === 0) {
    return img;
  }

  // 4. Handle relative paths - 纯云开发环境
  //    对于/images/路径，直接返回相对路径
  //    对于/uploads/路径，应该通过云存储访问（由JS处理）
  var finalPath = img;
  if (img.indexOf('/') !== 0) {
    finalPath = '/' + img;
  } 
  else if (img.indexOf('//') === 0) {
      finalPath = img.substring(1);
  }
  
  // 只处理本地静态图片，其他返回原路径
  if (finalPath.indexOf('/images/') === 0) {
    return finalPath;
  }
  
  // 其他情况返回原路径，让上层处理
  return finalPath;
}

var utils = {
  stringify: function(obj) {
    // WXS environment is tricky. JSON.stringify might fail or obj might be undefined.
    if (obj === undefined) {
      return 'undefined';
    }
    if (obj === null) {
      return 'null';
    }
    // Basic check if it's an array for slightly better representation if stringify fails
    if (typeof obj === 'object' && obj !== null && typeof obj.length === 'number') {
        // This is a basic array check for WXS, as Array.isArray is not available
        // We can't easily join here like in JS, so we'll rely on JSON.stringify
    }
    // Directly try to stringify. If JSON or stringify is not available or fails on the object,
    // this might throw an error or return something unexpected by the WXS runtime.
    // However, the previous error was "try is not defined", so let's see what this does.
    return JSON.stringify(obj); 
  }
}

module.exports = {
  getFullImageUrl: getFullImageUrl,
  stringify: utils.stringify
};