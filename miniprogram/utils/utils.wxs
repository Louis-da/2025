var BASE_URL = 'https://aiyunsf.com';

function getFullImageUrl(img) {
  // 1. Handle empty or null values
  if (!img) {
    // console.log('WXS: Input image is empty'); // WXS doesn't support console.log
    return '';
  }

  // 2. Handle wxfile temporary paths
  // WXS doesn't have startsWith, use indexOf
  if (img.indexOf('wxfile://') === 0) {
    return img;
  }

  // 3. Handle already absolute URLs
  if (img.indexOf('https://') === 0 || img.indexOf('http://') === 0) {
    return img;
  }

  // 4. Handle relative paths (Assume JS pre-processing added /uploads/ if needed)
  //    We just need to prepend the BASE_URL.
  //    Ensure the path starts with a single '/'.
  var finalPath = img;
  if (img.indexOf('/') !== 0) {
    // If it doesn't start with '/', add it.
    finalPath = '/' + img;
  } 
  // Avoid double slashes if img already started with '/'
  else if (img.indexOf('//') === 0) {
      finalPath = img.substring(1); // Remove one leading slash
  }
  
  // Prepend BASE_URL
  return BASE_URL + finalPath;
}

var utils = {
  stringify: function(obj) {
    // WXS environment is tricky. JSON.stringify might fail or obj might be undefined.
    if (obj === undefined) {
      return 'undefined';
    }
    if (obj === null) {
      return 'null';
    }
    // Basic check if it's an array for slightly better representation if stringify fails
    if (typeof obj === 'object' && obj !== null && typeof obj.length === 'number') {
        // This is a basic array check for WXS, as Array.isArray is not available
        // We can't easily join here like in JS, so we'll rely on JSON.stringify
    }
    // Directly try to stringify. If JSON or stringify is not available or fails on the object,
    // this might throw an error or return something unexpected by the WXS runtime.
    // However, the previous error was "try is not defined", so let's see what this does.
    return JSON.stringify(obj); 
  }
}

module.exports = {
  getFullImageUrl: getFullImageUrl,
  stringify: utils.stringify
}; 