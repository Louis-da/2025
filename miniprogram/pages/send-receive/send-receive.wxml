<view class="page-bg">
  <!-- å¯¼èˆªé€‰é¡¹å¡ -->
  <view class="card tabs-card">
    <view class="tabs">
      <view class="tab {{activeTab === 'send' ? 'active' : ''}}" bindtap="switchTab" data-tab="send">å‘å‡ºå•</view>
      <view class="tab {{activeTab === 'receive' ? 'active' : ''}}" bindtap="switchTab" data-tab="receive">æ”¶å›å•</view>
    </view>
  </view>

  <!-- æŠ¥è¡¨å…¥å£ -->
  <view class="card report-card">
    <view class="report-entry">
      <view class="report-item" bindtap="navigateToFlowTable">
        <image class="report-icon" src="/images/ui/flow-table.svg" mode="aspectFit"></image>
        <view class="report-text">æ”¶å‘æµæ°´è¡¨</view>
      </view>
      <view class="report-item" bindtap="navigateToStatement">
        <image class="report-icon" src="/images/ui/statement.svg" mode="aspectFit"></image>
        <view class="report-text">å¯¹è´¦å•</view>
      </view>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="card search-card">
    <view class="search-container">
      <view class="search-box">
        <view class="search-icon">ğŸ”</view>
        <input class="search-input" placeholder="æœç´¢å•å·ã€å·¥å‚" bindinput="inputSearch" value="{{searchQuery}}" confirm-type="search" />
        <view class="search-clear" bindtap="clearSearch" wx:if="{{searchQuery}}">âœ•</view>
      </view>
      <view class="filter-btn" bindtap="openFilter">
        <image class="filter-icon" src="/images/ui/filter.svg" mode="aspectFit"></image>
      </view>
    </view>
  </view>
  
  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="card order-list-card">
    <scroll-view class="order-list" scroll-y enable-flex>
      <view wx:if="{{orders.length === 0}}" class="empty-list">
        <image class="empty-icon" src="/images/ui/empty.svg" mode="aspectFit"></image>
        <view class="empty-text">æš‚æ— æ•°æ®</view>
      </view>
      <view wx:else class="list">
        <view wx:for="{{orders}}" wx:key="id" class="order-item-wrapper">
          <view class="order-item {{item.status === 0 ? 'canceled' : ''}}" bindtap="viewOrderDetail" data-id="{{item.id}}">
            <view class="order-header">
              <view class="order-no-small-gray">{{item.orderNo || 'æ— å•å·'}}</view>
              <view class="order-status" wx:if="{{item.status === 0}}">å·²ä½œåºŸ</view>
              <view class="share-icon share-icon-purple" catchtap="handleShare" data-id="{{item.id}}" data-type="{{activeTab}}" wx:if="{{item.status !== 0}}">
                <image src="/images/ui/share.svg" mode="aspectFit"></image>
              </view>
            </view>
            <view class="order-factory">{{item.factoryName || 'æœªçŸ¥å·¥å‚'}} <text wx:if="{{item.process}}">- {{item.process}}</text></view>
            <view class="order-details">
              <view class="detail-item">
                <view class="detail-label">é‡é‡</view>
                <view class="detail-value">{{item.totalWeight || item.weight || 0}}kg</view>
              </view>
              <view class="detail-item">
                <view class="detail-label">æ•°é‡</view>
                <view class="detail-value">{{item.totalQuantity || item.quantity || 0}}æ‰“</view>
              </view>
              <view class="detail-item" wx:if="{{item.fee && activeTab === 'receive'}}">
                <view class="detail-label">å·¥è´¹</view>
                <view class="detail-value">Â¥{{item.fee}}</view>
              </view>
            </view>
            <view class="order-footer">
              <view class="order-staff">åˆ¶å•ï¼š{{item.staff || 'æœªçŸ¥'}}</view>
              <view class="order-date">{{item.date || 'æ— æ—¥æœŸ'}}</view>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ–°å¢æŒ‰é’® -->
  <view class="add-button" bindtap="navigateToAdd">
    <view class="add-icon">+</view>
  </view>
  
  <!-- åº•éƒ¨ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="bottom-statistics">
    <view wx:if="{{activeTab === 'send'}}" class="statistics-content send-statistics">
      <view class="stat-item">
        <text class="stat-label">å…±</text>
        <text class="stat-value">{{totalSendCount}}</text>
        <text class="stat-unit">å•</text>
      </view>
      <view class="stat-separator">|</view>
      <view class="stat-item">
        <text class="stat-label">æ•°é‡</text>
        <text class="stat-value {{totalSendQuantityClass}}">{{totalSendQuantity}}</text>
        <text class="stat-unit">æ‰“</text>
      </view>
      <view class="stat-separator">|</view>
      <view class="stat-item">
        <text class="stat-label">é‡é‡</text>
        <text class="stat-value {{totalSendWeightClass}}">{{totalSendWeight}}</text>
        <text class="stat-unit">kg</text>
      </view>
    </view>
    
    <view wx:if="{{activeTab === 'receive'}}" class="statistics-content receive-statistics">
      <view class="stat-item">
        <text class="stat-label">å…±</text>
        <text class="stat-value">{{totalReceiveCount}}</text>
        <text class="stat-unit">å•</text>
      </view>
      <view class="stat-separator">|</view>
      <view class="stat-item">
        <text class="stat-label">æ•°é‡</text>
        <text class="stat-value {{totalReceiveQuantityClass}}">{{totalReceiveQuantity}}</text>
        <text class="stat-unit">æ‰“</text>
      </view>
      <view class="stat-separator">|</view>
      <view class="stat-item">
        <text class="stat-label">é‡é‡</text>
        <text class="stat-value {{totalReceiveWeightClass}}">{{totalReceiveWeight}}</text>
        <text class="stat-unit">kg</text>
      </view>
      <view class="stat-separator">|</view>
      <view class="stat-item">
        <text class="stat-label">é‡‘é¢</text>
        <text class="stat-value {{totalAmountClass}}">Â¥{{totalAmount}}</text>
      </view>
      <view class="stat-separator">|</view>
      <view class="stat-item">
        <text class="stat-label">æ”¯ä»˜</text>
        <text class="stat-value {{totalPaymentClass}}">Â¥{{totalPayment}}</text>
      </view>
    </view>
  </view>
</view>

<!-- ç­›é€‰å¼¹çª— -->
<view class="filter-modal {{showFilter ? 'filter-show' : ''}}">
  <view class="filter-overlay" bindtap="closeFilter"></view>
  <view class="filter-content">
    <view class="filter-header">
      <view class="filter-title">ç­›é€‰æ¡ä»¶</view>
      <view class="filter-close" bindtap="closeFilter">âœ•</view>
    </view>
    <view class="filter-body">
      <!-- æ—¥æœŸèŒƒå›´ -->
      <view class="filter-section">
        <view class="filter-label">æ—¥æœŸèŒƒå›´</view>
        <view class="date-range">
          <picker mode="date" value="{{filterStartDate}}" bindchange="onStartDateChange">
            <view class="date-picker">{{filterStartDate || 'å¼€å§‹æ—¥æœŸ'}}</view>
          </picker>
          <view class="date-separator">è‡³</view>
          <picker mode="date" value="{{filterEndDate}}" bindchange="onEndDateChange">
            <view class="date-picker">{{filterEndDate || 'ç»“æŸæ—¥æœŸ'}}</view>
          </picker>
        </view>
      </view>
      
      <!-- å·¥å‚é€‰æ‹© -->
      <view class="filter-section">
        <view class="filter-label">å·¥å‚</view>
        <view class="factory-dropdown-container">
          <view class="factory-search-input-wrapper">
            <input 
              class="filter-input {{selectedFilterFactory ? 'has-value' : ''}}" 
              placeholder="è¾“å…¥å·¥å‚åç§°æˆ–é¦–å­—æ¯"
              value="{{filterFactorySearchKeyword}}"
              bindinput="onFilterFactorySearch"
              bindtap="showFilterFactoryDropdown"
              bindfocus="showFilterFactoryDropdown"
              bindblur="hideFilterFactoryDropdownWithDelay"
              confirm-type="search"
            />
          </view>
          <!-- è‹¹æœç®€çº¦é£ä¸‹æ‹‰åˆ—è¡¨ -->
          <view class="factory-dropdown {{showFilterFactoryDropdown ? 'show' : ''}}" wx:if="{{showFilterFactoryDropdown}}">
            <scroll-view class="dropdown-scroll" scroll-y="true">
              <view wx:if="{{filteredFilterFactories.length === 0}}" class="dropdown-empty">
                <view class="empty-icon">ğŸ­</view>
                <view class="empty-text">æœªæ‰¾åˆ°ç›¸å…³å·¥å‚</view>
              </view>
              <view wx:else class="factory-dropdown-list">
                <!-- å…¨éƒ¨å·¥å‚é€‰é¡¹ -->
                <view 
                  class="factory-dropdown-item {{!selectedFilterFactory ? 'selected' : ''}}" 
                  catchtap="selectFilterFactoryFromDropdown" 
                  data-factory=""
                >
                  <view class="factory-info">
                    <view class="factory-name">å…¨éƒ¨å·¥å‚</view>
                    <view class="factory-details">
                      <text class="factory-subtitle">æŸ¥çœ‹æ‰€æœ‰å·¥å‚çš„è®¢å•</text>
                    </view>
                  </view>
                  <view class="check-mark" wx:if="{{!selectedFilterFactory}}">âœ“</view>
                </view>
                <!-- å…·ä½“å·¥å‚é€‰é¡¹ -->
                <view 
                  class="factory-dropdown-item {{selectedFilterFactory && selectedFilterFactory.id === item.id ? 'selected' : ''}}" 
                  wx:for="{{filteredFilterFactories}}" 
                  wx:key="id" 
                  catchtap="selectFilterFactoryFromDropdown" 
                  data-factory="{{item}}"
                >
                  <view class="factory-info">
                    <view class="factory-name">{{item.name}}</view>
                    <view class="factory-details" wx:if="{{item.phone || item.address}}">
                      <text class="factory-phone" wx:if="{{item.phone}}">ğŸ“ {{item.phone}}</text>
                      <text class="factory-address" wx:if="{{item.address}}">ğŸ“ {{item.address}}</text>
                    </view>
                  </view>
                  <view class="check-mark" wx:if="{{selectedFilterFactory && selectedFilterFactory.id === item.id}}">âœ“</view>
                </view>
              </view>
            </scroll-view>
          </view>
        </view>
      </view>
      
      <!-- å·¥åºé€‰æ‹© -->
      <view class="filter-section">
        <view class="filter-label">å·¥åº</view>
        <picker bindchange="onProcessChange" value="{{filterProcessIndex}}" range="{{processOptions}}" range-key="name">
          <view class="filter-picker {{filterProcessIndex > 0 ? 'has-value' : ''}}">
            {{filterProcessIndex > 0 ? processOptions[filterProcessIndex].name : 'é€‰æ‹©å·¥åº'}}
          </view>
        </picker>
      </view>
      
      <!-- è´§å·è¾“å…¥ -->
      <view class="filter-section">
        <view class="filter-label">è´§å·</view>
        <input class="filter-input" placeholder="è¾“å…¥è´§å·" bindinput="onProductCodeInput" value="{{filterProductCode}}" />
      </view>
      
      <!-- çŠ¶æ€é€‰æ‹© -->
      <view class="filter-section">
        <view class="filter-label">çŠ¶æ€</view>
        <picker bindchange="onStatusChange" value="{{filterStatusIndex}}" range="{{statusOptions}}">
          <view class="filter-picker">
            {{statusOptions[filterStatusIndex]}}
          </view>
        </picker>
      </view>
    </view>
    
    <view class="filter-footer">
      <button class="filter-reset" bindtap="resetFilter">é‡ç½®</button>
      <button class="filter-apply" bindtap="applyFilter">ç¡®å®š</button>
    </view>
  </view>
</view>

<!-- æ–°å¢canvasç”¨äºç»˜åˆ¶åˆ†äº«å›¾ç‰‡ -->
<canvas type="2d" id="shareCanvas" style="width: 1100px; height: 1900px; position: fixed; left: -9999px; top: -9999px;"></canvas>