<view class="page-bg">
  <!-- å¯¼èˆªé€‰é¡¹å¡ -->
  <view class="card tabs-card">
    <view class="tabs">
      <view class="tab {{activeTab === 'send' ? 'active' : ''}}" bindtap="switchTab" data-tab="send">å‘å‡ºå•</view>
      <view class="tab {{activeTab === 'receive' ? 'active' : ''}}" bindtap="switchTab" data-tab="receive">æ”¶å›å•</view>
    </view>
  </view>

  <!-- æŠ¥è¡¨å…¥å£ -->
  <view class="card report-card">
    <view class="report-entry">
      <view class="report-item" bindtap="navigateToFlowTable">
        <image class="report-icon" src="/images/ui/flow-table.svg" mode="aspectFit"></image>
        <view class="report-text">æ”¶å‘æµæ°´è¡¨</view>
      </view>
      <view class="report-item" bindtap="navigateToStatement">
        <image class="report-icon" src="/images/ui/statement.svg" mode="aspectFit"></image>
        <view class="report-text">å¯¹è´¦å•</view>
      </view>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="card search-card">
    <view class="search-container">
      <view class="search-box">
        <view class="search-icon">ğŸ”</view>
        <input class="search-input" placeholder="æœç´¢å•å·ã€å·¥å‚" bindinput="inputSearch" value="{{searchQuery}}" confirm-type="search" />
        <view class="search-clear" bindtap="clearSearch" wx:if="{{searchQuery}}">âœ•</view>
      </view>
      <view class="filter-btn" bindtap="openFilter">
        <image class="filter-icon" src="/images/ui/filter.svg" mode="aspectFit"></image>
      </view>
    </view>
  </view>
  
  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="card order-list-card">
    <scroll-view class="order-list" scroll-y enable-flex>
      <view wx:if="{{orders.length === 0}}" class="empty-list">
        <image class="empty-icon" src="/images/ui/empty.svg" mode="aspectFit"></image>
        <view class="empty-text">æš‚æ— æ•°æ®</view>
      </view>
      <view wx:else class="list">
        <view wx:for="{{orders}}" wx:key="id" class="order-item-wrapper" wx:if="{{item.status !== 'canceled' || showCanceled}}">
          <view class="order-item" bindtap="viewOrderDetail" data-id="{{item.id}}">
            <view class="order-header">
              <view class="order-no-small-gray">{{item.orderNo || 'æ— å•å·'}}</view>
              <view class="order-status" wx:if="{{item.status === 'canceled'}}">å·²ä½œåºŸ</view>
              <view class="share-icon share-icon-purple" catchtap="handleShare" data-id="{{item.id}}" data-type="{{activeTab}}" wx:if="{{item.status !== 'canceled'}}">
                <image src="/images/ui/share.svg" mode="aspectFit"></image>
              </view>
            </view>
            <view class="order-factory">{{item.factoryName || 'æœªçŸ¥å·¥å‚'}} <text wx:if="{{item.process}}">- {{item.process}}</text></view>
            <view class="order-details">
              <view class="detail-item">
                <view class="detail-label">é‡é‡</view>
                <view class="detail-value">{{item.totalWeight || item.weight || 0}}kg</view>
              </view>
              <view class="detail-item">
                <view class="detail-label">æ•°é‡</view>
                <view class="detail-value">{{item.totalQuantity || item.quantity || 0}}</view>
              </view>
              <view class="detail-item" wx:if="{{item.fee && activeTab === 'receive'}}">
                <view class="detail-label">å·¥è´¹</view>
                <view class="detail-value">Â¥{{item.fee}}</view>
              </view>
            </view>
            <view class="order-footer">
              <view class="order-staff">åˆ¶å•ï¼š{{item.staff || 'æœªçŸ¥'}}</view>
              <view class="order-date">{{item.date || 'æ— æ—¥æœŸ'}}</view>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ–°å¢æŒ‰é’® -->
  <view class="add-button" bindtap="navigateToAdd">
    <view class="add-icon">+</view>
  </view>
</view>

<!-- ç­›é€‰å¼¹çª— -->
<view class="filter-modal {{showFilter ? 'filter-show' : ''}}">
  <view class="filter-overlay" bindtap="closeFilter"></view>
  <view class="filter-content">
    <view class="filter-header">
      <view class="filter-title">ç­›é€‰æ¡ä»¶</view>
      <view class="filter-close" bindtap="closeFilter">âœ•</view>
    </view>
    <view class="filter-body">
      <!-- æ—¥æœŸèŒƒå›´ -->
      <view class="filter-section">
        <view class="filter-label">æ—¥æœŸèŒƒå›´</view>
        <view class="date-range">
          <picker mode="date" value="{{filterStartDate}}" bindchange="onStartDateChange">
            <view class="date-picker">{{filterStartDate || 'å¼€å§‹æ—¥æœŸ'}}</view>
          </picker>
          <view class="date-separator">è‡³</view>
          <picker mode="date" value="{{filterEndDate}}" bindchange="onEndDateChange">
            <view class="date-picker">{{filterEndDate || 'ç»“æŸæ—¥æœŸ'}}</view>
          </picker>
        </view>
      </view>
      
      <!-- å·¥å‚é€‰æ‹© -->
      <view class="filter-section">
        <view class="filter-label">å·¥å‚</view>
        <picker bindchange="onFactoryChange" value="{{filterFactoryIndex}}" range="{{factoryOptions}}" range-key="name">
          <view class="filter-picker {{filterFactoryIndex > 0 ? 'has-value' : ''}}">
            {{filterFactoryIndex > 0 ? factoryOptions[filterFactoryIndex].name : 'é€‰æ‹©å·¥å‚'}}
          </view>
        </picker>
      </view>
      
      <!-- å·¥åºé€‰æ‹© -->
      <view class="filter-section">
        <view class="filter-label">å·¥åº</view>
        <picker bindchange="onProcessChange" value="{{filterProcessIndex}}" range="{{processOptions}}" range-key="name">
          <view class="filter-picker {{filterProcessIndex > 0 ? 'has-value' : ''}}">
            {{filterProcessIndex > 0 ? processOptions[filterProcessIndex].name : 'é€‰æ‹©å·¥åº'}}
          </view>
        </picker>
      </view>
      
      <!-- è´§å·è¾“å…¥ -->
      <view class="filter-section">
        <view class="filter-label">è´§å·</view>
        <input class="filter-input" placeholder="è¾“å…¥è´§å·" bindinput="onProductCodeInput" value="{{filterProductCode}}" />
      </view>
      
      <!-- çŠ¶æ€é€‰æ‹© -->
      <view class="filter-section">
        <view class="filter-label">çŠ¶æ€</view>
        <picker bindchange="onStatusChange" value="{{filterStatusIndex}}" range="{{statusOptions}}">
          <view class="filter-picker">
            {{statusOptions[filterStatusIndex]}}
          </view>
        </picker>
      </view>
    </view>
    
    <view class="filter-footer">
      <button class="filter-reset" bindtap="resetFilter">é‡ç½®</button>
      <button class="filter-apply" bindtap="applyFilter">ç¡®å®š</button>
    </view>
  </view>
</view>

<!-- æ–°å¢canvasç”¨äºç»˜åˆ¶åˆ†äº«å›¾ç‰‡ -->
<canvas type="2d" id="shareCanvas" style="width: 1100px; height: 1900px; position: fixed; left: -9999px; top: -9999px;"></canvas>