<view class="container">
  <!-- ç®€æ´ç­›é€‰åŒºåŸŸ -->
  <view class="filter-section">
    <!-- è´§å“é€‰æ‹© -->
    <view class="filter-item">
      <view class="product-dropdown-container">
        <view class="product-search-input-wrapper">
          <input 
            class="filter-input {{selectedProduct ? 'has-value' : ''}}" 
            placeholder="é€‰æ‹©è´§å“"
            value="{{productInputValue}}"
            bindinput="onProductSearch"
            bindtap="showProductDropdown"
            bindfocus="onProductInputFocus"
            bindblur="hideProductDropdownWithDelay"
            confirm-type="search"
          />
        </view>
        <!-- è´§å“ä¸‹æ‹‰åˆ—è¡¨ -->
        <view class="product-dropdown {{showProductDropdown ? 'show' : ''}}" catchtap="">
          <scroll-view class="dropdown-scroll" scroll-y="true">
            <view wx:if="{{filteredProducts.length === 0}}" class="dropdown-empty">
              <view class="empty-icon">ğŸ“¦</view>
              <view class="empty-text">æœªæ‰¾åˆ°ç›¸å…³è´§å“</view>
            </view>
            <view wx:else class="product-dropdown-list">
              <!-- å…¨éƒ¨è´§å“é€‰é¡¹ -->
              <view 
                class="product-dropdown-item {{!selectedProduct ? 'selected' : ''}}" 
                catchtap="selectProductFromDropdown" 
                data-product=""
              >
                <view class="product-info">
                  <view class="product-name">å…¨éƒ¨è´§å“</view>
                  <view class="product-details">
                    <text class="product-subtitle">æŸ¥çœ‹æ‰€æœ‰è´§å“çš„æµæ°´ä¿¡æ¯</text>
                  </view>
                </view>
                <view class="check-mark" wx:if="{{!selectedProduct}}">âœ“</view>
              </view>
              <!-- å…·ä½“è´§å“é€‰é¡¹ -->
              <view 
                class="product-dropdown-item {{selectedProduct && selectedProduct === item.name ? 'selected' : ''}}" 
                wx:for="{{filteredProducts}}" 
                wx:key="id" 
                catchtap="selectProductFromDropdown" 
                data-product="{{item}}"
              >
                <view class="product-info">
                  <view class="product-name">{{item.productNo || item.code}}</view>
                  <view class="product-details" wx:if="{{item.name || item.process}}">
                    <text class="product-subtitle" wx:if="{{item.name}}">{{item.name}}</text>
                    <text class="product-process" wx:if="{{item.process}}">{{item.process}}</text>
                  </view>
                </view>
                <view class="check-mark" wx:if="{{selectedProduct && selectedProduct === item.name}}">âœ“</view>
              </view>
            </view>
          </scroll-view>
        </view>
      </view>
    </view>
    
    <!-- å·¥å‚é€‰æ‹© -->
    <view class="filter-item">
      <view class="factory-dropdown-container">
        <view class="factory-search-input-wrapper">
          <input 
            class="filter-input {{selectedFactory ? 'has-value' : ''}}" 
            placeholder="é€‰æ‹©å·¥å‚"
            value="{{factorySearchKeyword}}"
            bindinput="onFactorySearch"
            bindtap="showFactoryDropdown"
            bindfocus="showFactoryDropdown"
            bindblur="hideFactoryDropdownWithDelay"
            confirm-type="search"
          />
        </view>
        <!-- è‹¹æœç®€çº¦é£ä¸‹æ‹‰åˆ—è¡¨ -->
        <view class="factory-dropdown {{showFactoryDropdown ? 'show' : ''}}" wx:if="{{showFactoryDropdown}}">
          <scroll-view class="dropdown-scroll" scroll-y="true">
            <view wx:if="{{filteredFactories.length === 0}}" class="dropdown-empty">
              <view class="empty-icon">ğŸ­</view>
              <view class="empty-text">æœªæ‰¾åˆ°ç›¸å…³å·¥å‚</view>
            </view>
            <view wx:else class="factory-dropdown-list">
              <view 
                class="factory-dropdown-item {{selectedFactory === item.name ? 'selected' : ''}}" 
                wx:for="{{filteredFactories}}" 
                wx:key="id" 
                catchtap="selectFactoryFromDropdown" 
                data-factory="{{item}}"
              >
                <view class="factory-info">
                  <view class="factory-name">{{item.name}}</view>
                  <view class="factory-details" wx:if="{{item.phone || item.address}}">
                    <text class="factory-phone" wx:if="{{item.phone}}">ğŸ“ {{item.phone}}</text>
                    <text class="factory-address" wx:if="{{item.address}}">ğŸ“ {{item.address}}</text>
                  </view>
                </view>
                <view class="check-mark" wx:if="{{selectedFactory === item.name}}">âœ“</view>
              </view>
            </view>
          </scroll-view>
        </view>
      </view>
    </view>
    
    <!-- æ—¥æœŸèŒƒå›´ -->
    <view class="filter-item date-range">
      <picker mode="date" value="{{dateRange.start}}" bindchange="selectStartDate" class="date-picker">
        <view class="filter-input">
          <text>{{dateRange.start || 'å¼€å§‹æ—¥æœŸ'}}</text>
        </view>
      </picker>
      <text class="date-separator">è‡³</text>
      <picker mode="date" value="{{dateRange.end}}" bindchange="selectEndDate" class="date-picker">
        <view class="filter-input">
          <text>{{dateRange.end || 'ç»“æŸæ—¥æœŸ'}}</text>
        </view>
      </picker>
    </view>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <view class="filter-actions">
      <button class="query-btn" bindtap="onQueryTap">æŸ¥è¯¢</button>
      <button class="clear-btn" bindtap="clearAllFilters">é‡ç½®</button>
    </view>
  </view>
  
  <!-- æ´»è·ƒç­›é€‰æ ‡ç­¾ -->
  <view wx:if="{{hasFilter}}" class="active-filters">
    <view class="filter-tag" wx:if="{{selectedProduct}}">
      <text>è´§å“: {{selectedProduct}}</text>
      <view class="tag-close" data-type="product" bindtap="clearFilter">Ã—</view>
    </view>
    <view class="filter-tag" wx:if="{{selectedFactory}}">
      <text>å·¥å‚: {{selectedFactory}}</text>
      <view class="tag-close" data-type="factory" bindtap="clearFilter">Ã—</view>
    </view>
    <view class="filter-tag" wx:if="{{dateRange.start}}">
      <text>{{dateRange.start}} è‡³ {{dateRange.end || 'ä»Šå¤©'}}</text>
      <view class="tag-close" data-type="date" bindtap="clearFilter">Ã—</view>
    </view>
  </view>

  <!-- æµæ°´è®°å½•åˆ—è¡¨ -->
  <view wx:if="{{formattedDetailedRecords.length > 0}}" class="records-list">
    <view class="record-card" wx:for="{{formattedDetailedRecords}}" wx:key="id">
      <view class="card-header">
        <view class="header-left">
          <view class="record-type {{item.type === 'send' ? 'send-type' : 'receive-type'}}">
            {{item.typeText}}
          </view>
          <view class="order-no">{{item.order_no || '-'}}</view>
        </view>
        <view class="record-date">{{item.date}}</view>
      </view>
      
      <view class="card-content">
        <!-- ç¬¬ä¸€è¡Œï¼šè´§å·ã€åç§°ã€å·¥åºã€å·¥å‚ -->
        <view class="content-row">
          <view class="field-group-quarter">
            <text class="field-label">è´§å·</text>
            <text class="field-value">{{item.product_no}}</text>
          </view>
          <view class="field-group-quarter">
            <text class="field-label">åç§°</text>
            <text class="field-value">{{item.product_name || '-'}}</text>
          </view>
          <view class="field-group-quarter">
            <text class="field-label">å·¥åº</text>
            <text class="field-value">{{item.process_name}}</text>
          </view>
          <view class="field-group-quarter">
            <text class="field-label">å·¥å‚</text>
            <text class="field-value">{{item.factory_name}}</text>
          </view>
        </view>
        
        <!-- ç¬¬äºŒè¡Œï¼šé¢œè‰²ã€å°ºç ã€æ•°é‡ã€é‡é‡ -->
        <view class="content-row">
          <view class="field-group-quarter">
            <text class="field-label">é¢œè‰²</text>
            <text class="field-value">{{item.color || '-'}}</text>
          </view>
          <view class="field-group-quarter">
            <text class="field-label">å°ºç </text>
            <text class="field-value">{{item.size || '-'}}</text>
          </view>
          <view class="field-group-quarter">
            <text class="field-label">æ•°é‡</text>
            <text class="field-value">{{item.quantity}}æ‰“</text>
          </view>
          <view class="field-group-quarter">
            <text class="field-label">é‡é‡</text>
            <text class="field-value">{{item.weight}}kg</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{formattedDetailedRecords.length === 0 && !hasFilter}}" class="empty-state">
    <view class="empty-icon">ğŸ“‹</view>
    <text class="empty-title">æš‚æ— æµæ°´è®°å½•</text>
    <text class="empty-desc">å½“å‰æ²¡æœ‰ä»»ä½•æ”¶å‘æµæ°´æ•°æ®</text>
  </view>

  <view wx:if="{{formattedDetailedRecords.length === 0 && hasFilter}}" class="empty-state">
    <view class="empty-icon">ğŸ”</view>
    <text class="empty-title">æœªæ‰¾åˆ°åŒ¹é…è®°å½•</text>
    <text class="empty-desc">è¯·è°ƒæ•´ç­›é€‰æ¡ä»¶é‡æ–°æŸ¥è¯¢</text>
  </view>
</view>

